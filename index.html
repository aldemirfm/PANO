<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Fatih Mehmet Aldemir Panosu</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
/* === GENEL STƒ∞LLER === */
* { 
  margin: 0; 
  padding: 0; 
  box-sizing: border-box; 
}

html, body { 
  width: 100%; 
  height: 100%;
}

body {
  display: flex;
  flex-direction: column;
  font-family: "Segoe UI", Arial, sans-serif;
  background: #f3f6fa;
  overflow: hidden;
  height: 100vh;
}

/* === HEADER STƒ∞LLERƒ∞ === */
header {
  flex: 0 0 10%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 20px;
  background: linear-gradient(90deg, #2f26bf, #0D1A36);
  box-shadow: 0 2px 4px rgba(0,0,0,0.08);
}

#headerLeft { 
  flex: 1; 
  font-size: 1.8em; 
  font-weight: 900; 
  color: #fff; 
  text-align: left; 
}

#headerCenter { 
  flex: 0 0 auto; 
  display: flex; 
  justify-content: center; 
  align-items: center; 
}

#schoolLogo { 
  max-height: 500px; 
  max-width: 500px; 
  object-fit: contain; 
}

#headerRight { 
  flex: 1; 
  display: flex; 
  align-items: center; 
  justify-content: flex-end; 
  gap: 10px; 
}

#dayMonth { 
  font-size: 3em; 
  font-weight: 700; 
  color: #FFFFFF; 
}

#time { 
  font-size: 4em; 
  font-weight: 800; 
  color: #FFFFFF; 
}

/* === Y√ñNETƒ∞M PANELƒ∞ BUTTON === */
#adminPanelBtn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #2f26bf;
  color: white;
  border: none;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  font-size: 1.5em;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  z-index: 1000;
  transition: all 0.3s ease;
}

#adminPanelBtn:hover {
  background: #0D1A36;
  transform: scale(1.1);
}

/* === ANA GRID YAPISI - 4x4 === */
main {
  flex: 1 1 90%;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-template-rows: repeat(4, 1fr);
  gap: 5px;
  padding: 5px;
  align-items: stretch;
}

/* === KUTU STƒ∞LLERƒ∞ === */
.box {
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: stretch;
  text-align: center;
  border-radius: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  padding: 12px;
  font-size: 1em;
  font-weight: 700;
  width: 100%;
  height: 100%;
  margin: 0;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

.box:hover { 
  transform: translateY(-4px); 
  box-shadow: 0px 8px 16px rgba(0,0,0,0.12); 
}

.boxTitle {
  width: 100%;
  text-align: center;
  font-size: 2em;
  font-weight: 800;
  padding-bottom: 6px;
  margin-bottom: 8px;
  border-bottom: 2px solid rgba(255,255,255,0.4);
}

/* === KUTU POZƒ∞SYONLARI - 4x4 GRID === */

/* 1. SATIR */
#nobetci {
  grid-column: 1;
  grid-row: 1 / 3;
  background: linear-gradient(180deg, #000000, #202d58);
  color: #ffffff; /* Yazƒ± rengi eklendi */
}

/* WEB Sƒ∞TESƒ∞ KUTUSU */
#websiteBox {
  grid-column: 2 / 4;
  grid-row: 1 / 4;
  border-radius: 15px;
  overflow: hidden;
  position: relative;
  padding: 0;
}

#iframeWrapper {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: relative;
}

#webFrame {
  width: 100%;
  height: calc(100% + 300px);
  position: relative;
  top: -360px;
  border: none;
  display: block;
  transform: scale(1.35);
  image-rendering: -webkit-optimize-contrast; /* Netlik i√ßin */
  image-rendering: crisp-edges; /* Kenar netliƒüi */
  filter: contrast(1.1) brightness(1.05); /* Kontrast ve parlaklƒ±k */
}

/* 2. SATIR */
#examCountdown {
  grid-column: 1;
  grid-row: 3 / 5; 
  background: linear-gradient(0deg, #ff0000, #000000);
  color: #ffffff; /* Yazƒ± rengi eklendi */
}

#weatherBox {
  grid-column: 4;
  grid-row: 1 / 3;
  background: linear-gradient(0deg, #821590, #000000);
  position: relative;
  overflow: hidden;
  color: #ffffff; /* Yazƒ± rengi eklendi */
}

/* 3. SATIR */
#islam {
  grid-column: 2 / 4;
  grid-row: 4;
  background: linear-gradient(0deg, #ffffff, #fffcd4);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.4),
    inset 0 -1px 0 rgba(0, 0, 0, 0.1);
  color: #000000; /* Yazƒ± rengi eklendi */
}

#menuBox {
  grid-column: 4;
  grid-row: 3 / 5;
  background: linear-gradient(180deg, #000000, #1d6915);
  color: #ffffff; /* Yazƒ± rengi eklendi */
}

/* === ƒ∞√áERƒ∞K STƒ∞LLERƒ∞ === */

/* N√ñBET√áƒ∞ Lƒ∞STESƒ∞ */
#nobetciList { 
  text-align: left; 
  font-size: 0.9em; 
  height: 100%; /* Ekran y√ºksekliƒüi eklendi */
}

.nobetPlace { 
  color: #ffd63e;
  font-weight: 700;
  font-size: 1.8em;
  display: inline-block;
  width: 120px;
  vertical-align: top;
}

.nobetTeacher { 
  color: #ffffff;
  font-size: 1.8em;
  display: inline-block;
}

.nobetRow { 
  margin-bottom: 5px; 
  border-bottom: 1px solid rgba(255,255,255,0.2);
}

.nobetRow:last-child {
  border-bottom: none;
}

/* ORTAK BA≈ûLIK RENGƒ∞ */
#nobetci .boxTitle,
#weatherBox .boxTitle,
#menuBox .boxTitle {
  color: #ffd63e;
  font-size: 1.8em;
}

/* DUYURU METƒ∞NLERƒ∞ */
.announcementText,
#box1Content {
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
  width: 100%;
  height: 100%;
  font-weight: 700;
  padding: 10px;
  overflow: hidden;
}

.announcementText {
  font-size: 3em;
}

/* === HAVA DURUMU STƒ∞LLERƒ∞ === */
#currentWeather { 
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  gap: 20px;
  width: 100%;
  height: 60%;
  position: relative;
  z-index: 2;
}

#currentWeather img { 
  width: 200px; 
  height: 200px; 
  margin-right: 30px;
  animation: weatherIconMove 3s ease-in-out infinite,
             weatherIconGlow 3s ease-in-out infinite;
  filter: drop-shadow(0 0 10px rgba(0, 140, 255, 0.8));
  position: relative;
  z-index: 2;
}

/* HAVA DURUMU NEON YAZI STƒ∞LLERƒ∞ */
#temp {
  font-size: 4em;
  font-weight: 900;
  color: #ffffff;
  position: relative;
  z-index: 2;
  text-shadow: 
    0 0 0px #002bff,
    0 0 0px #002bff,
    0 0 0px #002bff;
  animation: neonGlow 2s ease-in-out infinite alternate;
}

#desc {
  font-size: 2.5em;
  font-weight: 900;
  color: #ffffff;
  position: relative;
  z-index: 2;
    text-shadow: 
    0 0 0px #002bff,
    0 0 0px #002bff,
    0 0 0px #002bff;
  animation: neonGlow 2s ease-in-out infinite alternate;
}

.forecast { 
  display: flex; 
  justify-content: space-around; 
  width: 100%;
  height: 40%;
  font-size: 2em;
  position: relative;
  z-index: 2;
    text-shadow: 
    0 0 0px #002bff,
    0 0 0px #002bff,
    0 0 0px #002bff;
  animation: neonGlow 2s ease-in-out infinite alternate;
}

.forecast .day { 
  display: flex; 
  flex-direction: column; 
  align-items: center; 
  padding: 5px; 
}

.forecast .dayName { 
  font-weight: 900; 
  font-size: 1em; 
  margin-bottom: 3px; 
  color: #ffffff; 
}

.forecast .temp { 
  font-size: 1.1em; 
  font-weight: 900; 
  color: #ffffff; 
}

/* === SINAV GERƒ∞ SAYIM === */
#examCountdown {
  display: flex; 
  flex-direction: row;
  justify-content: space-between;
  align-items: flex-start;
  gap: 10px; 
  height: 100%;
  padding: 0 20px;
}

.countdownItem {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100%;
  position: relative;
  width: 200px;
}

.countdownItem:first-child {
  border-right: 3px solid rgba(255,255,255,0.5);
  padding-right: 20px;
}

.countdownItem:last-child {
  padding-left: 20px;
}

.countdownTitle {
  font-size: 3em;
  font-weight: 800;
  color: white;
  margin-bottom: 5px;
}

.countdownValue {
  font-size: 4em;
  font-weight: 900;
  color: #00ff00;
  animation: blink 1.5s infinite;
  margin: 2px 0;
}

.countdownLabel {
  font-size: 2em;
  font-weight: 700;
  color: white;
}

/* === YEMEK Lƒ∞STESƒ∞ === */
#menuList {
  text-align: center;
  width: 100%;
  height: 100%;
  padding: 5px;
  font-weight: 700;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

.menu-row {
  width: 100%;
  margin: 0;
  padding: 2px 0;
  color: #ffffff;
  font-weight: 700;
}

.menu-row:last-child {
  border-bottom: none !important;
  margin-bottom: 0;
  padding-bottom: 0;
}

/* === MARQUEE === */
#marquee {
  flex: 0 0 auto;
  min-height: 100px;
  background: #003366;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  font-size: 5em;
  font-weight: 800;
  letter-spacing: 1px;
  position: relative;
  z-index: 1000;
}

#marquee span {
  position: absolute;
  white-space: nowrap;
  top: 50%;
  transform: translateY(-50%);
  left: 100%;
  animation: scrollText 10s linear infinite;
}

@keyframes scrollText {
  0% {
    left: 100%;
    transform: translateY(-50%) translateX(0);
  }
  100% {
    left: 0;
    transform: translateY(-50%) translateX(-100%);
  }
}

/* === ANƒ∞MASYONLAR === */

/* Genel Animasyonlar */
@keyframes blink {
  0% { opacity: 1; }
  50% { opacity: 0.5; }
  100% { opacity: 1; }
}


@keyframes weatherIconMove {
  0%   { transform: translateY(0px); }
  50%  { transform: translateY(-10px); }
  100% { transform: translateY(0px); }
}

@keyframes weatherIconGlow {
  0%   { filter: drop-shadow(0 0 6px rgba(0, 140, 255, .5)); }
  50%  { filter: drop-shadow(0 0 22px rgba(0, 140, 255, .95)); }
  100% { filter: drop-shadow(0 0 6px rgba(0, 140, 255, .5)); }
}

/* Hava Durumu Animasyonlarƒ± */
#weatherAnimation {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1;
  overflow: hidden;
}

/* === KAR ANƒ∞MASYONLARI === */
.snow-flake {
  position: absolute;
  top: -50px;
  background: transparent;
  pointer-events: none;
  filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.8));
}

/* Yoƒüun kar i√ßin */
.snow-heavy-small { width: 20px; height: 20px; animation: snow-heavy 6s linear infinite; }
.snow-heavy-medium { width: 30px; height: 30px; animation: snow-heavy 8s linear infinite; }
.snow-heavy-large { width: 40px; height: 40px; animation: snow-heavy 12s linear infinite; }

/* Hafif kar i√ßin */
.snow-light-small { width: 25px; height: 25px; animation: snow-light 15s linear infinite; }
.snow-light-medium { width: 35px; height: 35px; animation: snow-light 20s linear infinite; }
.snow-light-large { width: 45px; height: 45px; animation: snow-light 25s linear infinite; }

/* Yoƒüun kar animasyonu */
@keyframes snow-heavy {
  0% {
    transform: translateY(-50px) translateX(0) rotate(0deg);
    opacity: 0;
  }
  5% { opacity: 0.9; }
  95% { opacity: 0.9; }
  100% {
    transform: translateY(100vh) translateX(80px) rotate(540deg);
    opacity: 0;
  }
}

/* Hafif kar animasyonu */
@keyframes snow-light {
  0% {
    transform: translateY(-50px) translateX(-30px) rotate(0deg);
    opacity: 0;
  }
  10% { opacity: 0.7; }
  90% { opacity: 0.7; }
  100% {
    transform: translateY(100vh) translateX(30px) rotate(360deg);
    opacity: 0;
  }
}

/* Yaƒümur */
.rain-drop {
  position: absolute;
  top: -20px;
  background: linear-gradient(to bottom, transparent, #87CEEB);
  animation: rain-fall linear infinite;
  border-radius: 50%;
}

@keyframes rain-fall {
  0% {
    transform: translateY(-20px);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  90% {
    opacity: 1;
  }
  100% {
    transform: translateY(100vh);
    opacity: 0;
  }
}

/* G√ºne≈ü */
.sun-animation {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 40px;
  height: 40px;
  background: radial-gradient(circle, #FFD700, #FFA500);
  border-radius: 50%;
  animation: sun-pulse 3s ease-in-out infinite;
  box-shadow: 0 0 20px #FFD700, 0 0 40px #FFA500;
}

@keyframes sun-pulse {
  0%, 100% {
    transform: scale(1);
    opacity: 0.8;
  }
  50% {
    transform: scale(1.1);
    opacity: 1;
  }
}

/* Bulut */
.cloud-img {
  position: absolute;
  width: 100px;
  height: auto;
  opacity: 0.8;
  animation: cloud-move linear infinite;
}

@keyframes cloud-move {
  0% { transform: translateX(-150px); }
  100% { transform: translateX(110vw); }
}

/* Sis */
.fog {
  position: absolute;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.1),
    transparent
  );
  animation: fog-move 10s linear infinite;
}

@keyframes fog-move {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

/* === EXCEL Y√úKLEME ARAY√úZ√ú === */
#excelUploadModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  z-index: 10000;
  justify-content: center;
  align-items: center;
}

#excelUploadContent {
  background: white;
  padding: 30px;
  border-radius: 15px;
  width: 90%;
  max-width: 600px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

#excelUploadContent h2 {
  margin-bottom: 20px;
  color: #2f26bf;
  text-align: center;
}

.upload-section {
  margin-bottom: 25px;
  padding: 15px;
  border: 1px solid #ddd;
  border-radius: 10px;
}

.upload-section h3 {
  margin-bottom: 10px;
  color: #0D1A36;
}

.file-input-wrapper {
  position: relative;
  margin-bottom: 10px;
}

.file-input-wrapper input[type="file"] {
  position: absolute;
  left: -9999px;
  opacity: 0;
}

.file-input-wrapper label {
  display: block;
  background: #f0f0f0;
  padding: 12px;
  border: 2px dashed #ccc;
  border-radius: 5px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s;
}

.file-input-wrapper label:hover {
  background: #e0e0e0;
  border-color: #2f26bf;
}

.file-name {
  margin-top: 5px;
  font-size: 0.9em;
  color: #666;
}

.upload-section button {
  background: #2f26bf;
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  transition: background 0.3s;
  width: 100%;
}

.upload-section button:hover {
  background: #0D1A36;
}

.upload-section button:disabled {
  background: #ccc;
  cursor: not-allowed;
}

#closeExcelModal {
  display: block;
  margin: 20px auto 0;
  background: #ff0000;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
}

/* === RESPONSIVE TASARIM === */
@media (max-width: 1200px) {
  main {
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(5, 1fr);
  }
  
  #nobetci {
    grid-column: 1;
    grid-row: 1 / 3;
  }
  
  #websiteBox {
    grid-column: 2 / 4;
    grid-row: 1 / 4;
  }
  
  #examCountdown {
    grid-column: 1;
    grid-row: 3 / 5;
  }
  
  #weatherBox {
    grid-column: 2;
    grid-row: 4 / 6;
  }
  
  #islam {
    grid-column: 3;
    grid-row: 4 / 6;
  }
  
  #menuBox {
    grid-column: 1;
    grid-row: 5;
  }
}

@media (max-width: 768px) {
  main {
    grid-template-columns: 1fr;
    grid-template-rows: repeat(6, 1fr);
  }
  
  #nobetci {
    grid-column: 1;
    grid-row: 1;
  }
  
  #websiteBox {
    grid-column: 1;
    grid-row: 2;
  }
  
  #examCountdown {
    grid-column: 1;
    grid-row: 3;
  }
  
  #weatherBox {
    grid-column: 1;
    grid-row: 4;
  }
  
  #islam {
    grid-column: 1;
    grid-row: 5;
  }
  
  #menuBox {
    grid-column: 1;
    grid-row: 6;
  }
  
  header {
    flex-direction: column;
    padding: 10px;
  }
  
  #headerLeft, #headerRight {
    text-align: center;
    margin-bottom: 10px;
  }
  
  #dayMonth, #time {
    font-size: 2em;
  }
  
  #marquee {
    font-size: 3em;
    min-height: 70px;
  }
  
  #adminPanelBtn {
    width: 50px;
    height: 50px;
    font-size: 1.2em;
    bottom: 10px;
    right: 10px;
  }
}

@media (max-width: 480px) {
  .boxTitle {
    font-size: 1.5em;
  }
  
  #dayMonth, #time {
    font-size: 1.5em;
  }
  
  #marquee {
    font-size: 2em;
    min-height: 50px;
  }
  
  .countdownTitle {
    font-size: 2em;
  }
  
  .countdownValue {
    font-size: 2.5em;
  }
  
  .countdownLabel {
    font-size: 1.5em;
  }
}

/* Gƒ∞ZLƒ∞ BA≈ûLIKLAR */
#islam .boxTitle {
  display: none;
}
</style>
</head>
<body>
<header>
  <div id="headerLeft">AHMED ƒ∞SLAMOƒûLU<br>ANADOLU ƒ∞MAM HATƒ∞P Lƒ∞SESƒ∞</div>
  <div id="headerCenter"><img src="https://imgr.tr/i/i691b09883ef4f" alt="Okul Logosu" id="schoolLogo"></div>
  <div id="headerRight">
    <span id="dayMonth"></span>
    <span id="time"></span>
  </div>
</header>

<main>
  <div class="box" id="nobetci">
    <div class="boxTitle">N√ñBET√áƒ∞ √ñƒûRETMENLER</div>
    <div id="nobetciList">Y√ºkleniyor...</div>
  </div>

  <div class="box" id="websiteBox">
    <div id="iframeWrapper">
      <iframe id="webFrame" src="https://develiihl.meb.k12.tr/"></iframe>
    </div>
  </div>

  <div class="box" id="examCountdown">
    <div class="countdownItem">
      <div class="countdownTitle">YKS</div>
      <div class="countdownValue" id="yksCountdownNum">--</div>
      <div class="countdownLabel">G√úN</div>
      <div class="countdownValue" id="yksCountdownHour">--</div>
      <div class="countdownLabel">SAAT</div>
    </div>
    <div class="countdownItem">
      <div class="countdownTitle">LGS</div>
      <div class="countdownValue" id="lgsCountdownNum">--</div>
      <div class="countdownLabel">G√úN</div>
      <div class="countdownValue" id="lgsCountdownHour">--</div>
      <div class="countdownLabel">SAAT</div>
    </div>
  </div>

  <div class="box" id="weatherBox">
    <div class="boxTitle">HAVA DURUMU</div>
    <div id="weatherAnimation"></div>
    <div id="currentWeather">
      <img id="weatherIcon" src="" alt="icon">
      <div>
        <div id="temp">--¬∞C</div>
        <div id="desc">Y√ºkleniyor...</div>
      </div>
    </div>
    <div class="forecast">
      <div class="day"><div class="dayName">--</div><div class="temp">--¬∞C</div></div>
      <div class="day"><div class="dayName">--</div><div class="temp">--¬∞C</div></div>
      <div class="day"><div class="dayName">--</div><div class="temp">--¬∞C</div></div>
    </div>
  </div>

  <div class="box" id="islam">
    <div id="box1Content">Y√ºkleniyor...</div>
  </div>

  <div class="box" id="menuBox">
    <div class="boxTitle">YEMEK Lƒ∞STESƒ∞</div>
    <div id="menuList">Y√ºkleniyor...</div>
  </div>
</main>

<div id="marquee"><span>HO≈û GELDƒ∞Nƒ∞Z</span></div>

<button id="adminPanelBtn" title="Excel Y√ºkleme Paneli">‚öôÔ∏è</button>

<div id="excelUploadModal">
  <div id="excelUploadContent">
    <h2>Excel Dosyalarƒ±nƒ± Y√ºkle</h2>
    
    <div class="upload-section">
      <h3>N√∂bet√ßi √ñƒüretmen Listesi</h3>
      <div class="file-input-wrapper">
        <input type="file" id="dutyFile" accept=".xlsx, .xls">
        <label for="dutyFile">Excel Dosyasƒ± Se√ßin</label>
        <div class="file-name" id="dutyFileName">Dosya se√ßilmedi</div>
      </div>
      <button id="uploadDutyBtn" disabled>N√∂bet√ßi Listesini Y√ºkle</button>
    </div>
    
    <div class="upload-section">
      <h3>Yemek Listesi</h3>
      <div class="file-input-wrapper">
        <input type="file" id="menuFile" accept=".xlsx, .xls">
        <label for="menuFile">Excel Dosyasƒ± Se√ßin</label>
        <div class="file-name" id="menuFileName">Dosya se√ßilmedi</div>
      </div>
      <button id="uploadMenuBtn" disabled>Yemek Listesini Y√ºkle</button>
    </div>
    
    <div class="upload-section">
      <h3>G√ºn√ºn S√∂z√º</h3>
      <div class="file-input-wrapper">
        <input type="file" id="quoteFile" accept=".xlsx, .xls">
        <label for="quoteFile">Excel Dosyasƒ± Se√ßin</label>
        <div class="file-name" id="quoteFileName">Dosya se√ßilmedi</div>
      </div>
      <button id="uploadQuoteBtn" disabled>G√ºn√ºn S√∂z√ºn√º Y√ºkle</button>
    </div>
    
    <button id="closeExcelModal">Kapat</button>
  </div>
</div>

<script>
// === EXCEL Y√úKLEME Sƒ∞STEMƒ∞ ===
let dutyData = null;
let menuData = null;
let quoteData = null;

// Y√∂netim paneli butonu
document.getElementById('adminPanelBtn').addEventListener('click', function() {
  document.getElementById('excelUploadModal').style.display = 'flex';
});

// Modal kapatma
document.getElementById('closeExcelModal').addEventListener('click', function() {
  document.getElementById('excelUploadModal').style.display = 'none';
});

// Dosya se√ßim i≈üleyicileri
function setupFileInput(fileInputId, fileNameId, buttonId) {
  const fileInput = document.getElementById(fileInputId);
  const fileName = document.getElementById(fileNameId);
  const button = document.getElementById(buttonId);
  
  fileInput.addEventListener('change', function(e) {
    if (this.files.length > 0) {
      fileName.textContent = this.files[0].name;
      button.disabled = false;
    } else {
      fileName.textContent = 'Dosya se√ßilmedi';
      button.disabled = true;
    }
  });
}

// Dosya input'larƒ±nƒ± ayarla
setupFileInput('dutyFile', 'dutyFileName', 'uploadDutyBtn');
setupFileInput('menuFile', 'menuFileName', 'uploadMenuBtn');
setupFileInput('quoteFile', 'quoteFileName', 'uploadQuoteBtn');

// Excel dosyasƒ±nƒ± okuma fonksiyonu (G√úNCELLENDƒ∞)
function readExcelFile(file, callback) {
  const reader = new FileReader();
  
  reader.onload = function(e) {
    const data = new Uint8Array(e.target.result);
    
    try {
      if (typeof XLSX === 'undefined') {
        alert("Hata: XLSX k√ºt√ºphanesi y√ºklenemedi. ƒ∞nternet baƒülantƒ±nƒ±zƒ± kontrol edin.");
        return;
      }
      
      // raw: true ayarƒ±, tarih gibi h√ºcre i√ßeriƒüini ham (sayƒ±sal) formatta tutar.
      const workbook = XLSX.read(data, {type: 'array', cellDates: false, raw: true}); 
      
      // ƒ∞lk sayfayƒ± al
      const firstSheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[firstSheetName];
      
      // JSON formatƒ±na d√∂n√º≈üt√ºr, header: 1 ile t√ºm veriler array of array olarak gelir.
      const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
      
      callback(jsonData);
      
    } catch (error) {
      console.error("Excel okuma hatasƒ±:", error);
      alert("Excel dosyasƒ± i≈ülenirken bir hata olu≈ütu. Dosya formatƒ±nƒ± kontrol edin.");
    }
  };
  
  reader.readAsArrayBuffer(file);
}

// N√∂bet√ßi √∂ƒüretmen y√ºkleme
document.getElementById('uploadDutyBtn').addEventListener('click', function() {
  const fileInput = document.getElementById('dutyFile');
  if (fileInput.files.length === 0) {
    alert('L√ºtfen bir Excel dosyasƒ± se√ßin.');
    return;
  }
  
  readExcelFile(fileInput.files[0], function(data) {
    dutyData = data;
    // Veriyi localStorage'a JSON olarak kaydet
    localStorage.setItem('dutyData', JSON.stringify(data)); 
    processDutyData();
    alert('N√∂bet√ßi √∂ƒüretmen listesi ba≈üarƒ±yla y√ºklendi ve kaydedildi!');
    document.getElementById('excelUploadModal').style.display = 'none';
  });
});

// Yemek listesi y√ºkleme
document.getElementById('uploadMenuBtn').addEventListener('click', function() {
  const fileInput = document.getElementById('menuFile');
  if (fileInput.files.length === 0) {
    alert('L√ºtfen bir Excel dosyasƒ± se√ßin.');
    return;
  }
  
  readExcelFile(fileInput.files[0], function(data) {
    menuData = data;
    // Veriyi localStorage'a JSON olarak kaydet
    localStorage.setItem('menuData', JSON.stringify(data));
    processMenuData();
    alert('Yemek listesi ba≈üarƒ±yla y√ºklendi ve kaydedildi!');
    document.getElementById('excelUploadModal').style.display = 'none';
  });
});

// G√ºn√ºn s√∂z√º y√ºkleme (G√úNCELLENDƒ∞: localStorage eklendi)
document.getElementById('uploadQuoteBtn').addEventListener('click', function() {
  const fileInput = document.getElementById('quoteFile');
  if (fileInput.files.length === 0) {
    alert('L√ºtfen bir Excel dosyasƒ± se√ßin.');
    return;
  }
  
  readExcelFile(fileInput.files[0], function(data) {
    quoteData = data;
    // Veriyi localStorage'a JSON olarak kaydet
    localStorage.setItem('quoteData', JSON.stringify(data)); 
    processQuoteData();
    alert('G√ºn√ºn s√∂z√º ba≈üarƒ±yla y√ºklendi ve kaydedildi!');
    document.getElementById('excelUploadModal').style.display = 'none';
  });
});

// G√ºn√ºn s√∂z√º y√ºkleme
document.getElementById('uploadQuoteBtn').addEventListener('click', function() {
  const fileInput = document.getElementById('quoteFile');
  if (fileInput.files.length === 0) {
    alert('L√ºtfen bir Excel dosyasƒ± se√ßin.');
    return;
  }
  
  readExcelFile(fileInput.files[0], function(data) {
    quoteData = data;
    processQuoteData();
    alert('G√ºn√ºn s√∂z√º ba≈üarƒ±yla y√ºklendi!');
    document.getElementById('excelUploadModal').style.display = 'none';
  });
});

// N√∂bet√ßi verilerini i≈üleme
function processDutyData() {
  if (!dutyData || dutyData.length < 2) {
    document.getElementById("nobetciList").innerHTML = 'N√∂bet√ßi verisi bulunamadƒ±.';
    return;
  }
  
  const days = [null,"PAZARTESƒ∞","SALI","√áAR≈ûAMBA","PER≈ûEMBE","CUMA",null];
  const today = days[new Date().getDay()];
  
  const headers = dutyData[0].map(h => h?.toString().toUpperCase() || "");
  const colIndex = headers.indexOf(today);
  
  if (colIndex === -1) {
    document.getElementById("nobetciList").innerHTML = '<span style="font-size:10em;">ü•∏</span><br>Bug√ºn i√ßin n√∂bet s√ºtunu yok.';
    return;
  }
  
  let output = "";
  let hasDuty = false;
  
  for (let i = 1; i < dutyData.length; i++) {
    const place = dutyData[i][0]?.toString() || "";
    const teacherCell = dutyData[i][colIndex]?.toString() || "";
    if (!place && !teacherCell) continue;
    
    const teachers = teacherCell.split("\n").filter(t => t.trim() !== "");
    
    if (teachers.length > 0) {
      hasDuty = true;
      output += `<div class="nobetRow">`;
      if(place) output += `<span class="nobetPlace">${place}:</span> `;
      output += `<span class="nobetTeacher">`;
      teachers.forEach(t => {
        output += `${t}<br>`;
      });
      output += `</span>`;
      output += `</div>`;
    }
  }
  
  document.getElementById("nobetciList").innerHTML = output || "BUG√úN N√ñBET YOK";
}

// Yemek listesi verilerini i≈üleme
// Yemek listesi verilerini i≈üleme (G√úNCELLENDƒ∞)
function processMenuData() {
  const menuListElement = document.getElementById("menuList");
  
  if (!menuData || menuData.length < 2) {
    menuListElement.innerHTML = '<div class="menu-row">Yemek listesi verisi bulunamadƒ±.</div>';
    fitMenuText();
    return;
  }
  
  const now = new Date();
  const todayDateString = `${now.getDate().toString().padStart(2, "0")}.${(now.getMonth() + 1).toString().padStart(2, "0")}.${now.getFullYear()}`;
  
  let output = "Bu g√ºne ait yemek listesi yok.";
  let found = false;
  
  for (let i = 1; i < menuData.length; i++) { // Ba≈ülƒ±k satƒ±rƒ± olan 0'ƒ± atla
    const row = menuData[i];
    const dateCell = row[0]; // A S√ºtunu: Tarih
    const foodCell = row[1]; // B S√ºtunu: Yemek
    
    if (!dateCell || !foodCell) continue;
    
    let sheetDateString = null;
    
    // 1. Durum: Excel'in sayƒ±sal tarih formatƒ± (40000'li sayƒ±lar)
    if (typeof dateCell === 'number' && dateCell > 1) {
        // Excel tarihini JS tarihine d√∂n√º≈üt√ºr (1900 temel alƒ±narak)
        const date = new Date(Date.UTC(0, 0, dateCell - 1)); 
        sheetDateString = `${date.getUTCDate().toString().padStart(2, "0")}.${(date.getUTCMonth() + 1).toString().padStart(2, "0")}.${date.getUTCFullYear()}`;
    } 
    // 2. Durum: Normal metin/tarih formatƒ± (d.m.y veya d/m/y)
    else if (typeof dateCell === 'string') {
        let trimmedDate = dateCell.trim();
        // Tarih stringini d.m.yyyy formatƒ±na √ßevir
        let dateParts = trimmedDate.split(/[\.\/\-]/);
        if (dateParts.length >= 3) {
            const sheetDay = dateParts[0].padStart(2, "0");
            const sheetMonth = dateParts[1].padStart(2, "0");
            // Yƒ±l 2 haneliyse 20 ekle
            const sheetYear = dateParts[2].length === 2 ? "20" + dateParts[2] : dateParts[2];
            sheetDateString = `${sheetDay}.${sheetMonth}.${sheetYear}`;
        }
    }
    
    if (sheetDateString === todayDateString) {
      // Yemek h√ºcresindeki t√ºm satƒ±rlarƒ± al
      const foods = foodCell.toString().split("\n").filter(food => food.trim() !== "");
      
      if (foods.length > 0) {
        let formattedOutput = '';
        foods.forEach((food) => {
          formattedOutput += `<div class="menu-row">${food.trim()}</div>`;
        });
        output = formattedOutput;
        found = true;
      } else {
        output = '<div class="menu-row">Yemek listesi bo≈ü.</div>';
        found = true; 
      }
      break;
    }
  }
  
  if (found) {
    menuListElement.innerHTML = output;
  } else {
    menuListElement.innerHTML = `<div class="menu-row">${output}</div>`;
  }

  fitMenuText();
}

// G√ºn√ºn s√∂z√º verilerini i≈üleme (G√úNCELLENDƒ∞: Sayƒ±sal tarih desteƒüi eklendi)
function processQuoteData() {
  const islamElement = document.getElementById("box1Content");
  
  if (!quoteData || quoteData.length < 2) {
    islamElement.innerHTML = "L√ºtfen G√ºn√ºn S√∂z√º listesini y√ºkleyin.";
    fitTextToBox();
    return;
  }
  
  const now = new Date();
  const todayDateString = `${now.getDate().toString().padStart(2, "0")}.${(now.getMonth() + 1).toString().padStart(2, "0")}.${now.getFullYear()}`;
  
  let quote = "Bu g√ºne ait ilham verici s√∂z yok.";
  
  for (let i = 1; i < quoteData.length; i++) {
    const row = quoteData[i];
    const dateCell = row[0]; // A S√ºtunu: Tarih
    const quoteCell = row[1]; // B S√ºtunu: S√∂zler
    
    if (!dateCell || !quoteCell) continue;
    
    let sheetDateString = null;
    
    // 1. Durum: Excel'in sayƒ±sal tarih formatƒ± (40000'li sayƒ±lar)
    if (typeof dateCell === 'number' && dateCell > 1) {
        // Excel tarihini JS tarihine d√∂n√º≈üt√ºr (1900 temel alƒ±narak)
        const date = new Date(Date.UTC(0, 0, dateCell - 1)); 
        sheetDateString = `${date.getUTCDate().toString().padStart(2, "0")}.${(date.getUTCMonth() + 1).toString().padStart(2, "0")}.${date.getUTCFullYear()}`;
    } 
    // 2. Durum: Normal metin/tarih formatƒ± (gg.aa.yyyy, gg/aa/yyyy, vb.)
    else if (typeof dateCell === 'string') {
        let trimmedDate = dateCell.trim();
        // Tarih stringini d.m.yyyy formatƒ±na √ßevir
        let dateParts = trimmedDate.split(/[\.\/\-]/);
        if (dateParts.length >= 3) {
            const sheetDay = dateParts[0].padStart(2, "0");
            const sheetMonth = dateParts[1].padStart(2, "0");
            // Yƒ±l 2 haneliyse 20 ekle
            const sheetYear = dateParts[2].length === 2 ? "20" + dateParts[2] : dateParts[2];
            sheetDateString = `${sheetDay}.${sheetMonth}.${sheetYear}`;
        }
    }
    
    if (sheetDateString === todayDateString) {
      quote = quoteCell.toString() || "S√∂z listesi bo≈ü.";
      break;
    }
  }
  
  // S√∂z√º satƒ±r sonlarƒ±na g√∂re d√ºzenle
  islamElement.innerHTML = quote.split("\n").join("<br>");
  fitTextToBox();
}

// === METƒ∞N SIKI≈ûTIRMA FONKSƒ∞YONLARI ===
function fitTextToBox() {
  const container = document.getElementById("box1Content");
  const maxHeight = container.clientHeight;
  const maxWidth = container.clientWidth;
  
  if (!container.firstElementChild) return; // ƒ∞√ßerik yoksa √ßƒ±k

  let fontSize = 10;
  container.style.fontSize = fontSize + "px";

  // Metni sƒ±ƒüdƒ±rana kadar b√ºy√ºt
  while(container.scrollHeight <= maxHeight && container.scrollWidth <= maxWidth && fontSize < 200) {
    fontSize += 1;
    container.style.fontSize = fontSize + "px";
  }

  // Sƒ±nƒ±rƒ± a≈ümadan √∂nceki boyuta geri d√∂n
  container.style.fontSize = (fontSize - 1) + "px";
}

function fitMenuText() {
  const container = document.getElementById("menuList");
  const maxHeight = container.clientHeight;
  const maxWidth = container.clientWidth;
  
  if (!container.firstElementChild) return; // ƒ∞√ßerik yoksa √ßƒ±k

  let fontSize = 10;
  container.style.fontSize = fontSize + "px";

  while(container.scrollHeight <= maxHeight && container.scrollWidth <= maxWidth && fontSize < 200) {
    fontSize += 1;
    container.style.fontSize = fontSize + "px";
  }

  container.style.fontSize = (fontSize - 1) + "px";
}

// === TAM EKRAN ===
function enableFullScreen() {
  const elem = document.documentElement;
  if (elem.requestFullscreen) elem.requestFullscreen();
  else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
  else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
  window.removeEventListener("click", enableFullScreen);
}
// window.addEventListener("click", enableFullScreen); // Otomatik tam ekranƒ± devre dƒ±≈üƒ± bƒ±raktƒ±m, isteƒüe baƒülƒ± a√ßƒ±labilir

// === TARƒ∞H & SAAT ===
function updateDateTime() {
  const now = new Date();
  const days = ["Pazar","Pazartesi","Salƒ±","√áar≈üamba","Per≈üembe","Cuma","Cumartesi"];
  const months = ["Ocak","≈ûubat","Mart","Nisan","Mayƒ±s","Haziran","Temmuz","Aƒüustos","Eyl√ºl","Ekim","Kasƒ±m"];
  
  const dayName = days[now.getDay()];
  const dateNum = now.getDate();
  const monthName = months[now.getMonth()];
  const hours = now.getHours().toString().padStart(2,"0");
  const minutes = now.getMinutes().toString().padStart(2,"0");
  
  document.getElementById("dayMonth").innerText = `${dayName}, ${dateNum} ${monthName}`;
  document.getElementById("time").innerText = `${hours}:${minutes}`;
}
setInterval(updateDateTime, 1000);
updateDateTime();

// === SINAV GERƒ∞ SAYIM ===
function countdown(target, numEl, hourEl) {
  const now = new Date();
  const diff = target - now;
  
  if (diff <= 0) {
    document.getElementById(numEl).innerText = "0";
    document.getElementById(hourEl).innerText = "0";
    return;
  }
  
  const days = Math.floor(diff / (1000 * 60 * 60 * 24));
  const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  
  document.getElementById(numEl).innerText = days;
  document.getElementById(hourEl).innerText = hours;
}

// DOMContentLoaded i√ßinde kullanƒ±n:
document.addEventListener('DOMContentLoaded', () => {
  setInterval(()=>{
    // YKS: 20 Haziran 2026 saat 10:30
    countdown(new Date("2026-06-20T10:30:00"), "yksCountdownNum","yksCountdownHour");
    // LGS: 14 Haziran 2026 saat 09:30
    countdown(new Date("2026-06-14T09:30:00"), "lgsCountdownNum","lgsCountdownHour");
  }, 1000);
});


// === HAVA DURUMU ANƒ∞MASYON Sƒ∞STEMƒ∞ ===
class WeatherAnimation {
  constructor() {
    this.container = document.getElementById('weatherAnimation');
    this.currentWeather = '';
    this.thunderstormInterval = null; // Fƒ±rtƒ±na i√ßin intervali sakla
  }

  setWeather(weatherType) {
    this.clearAnimation();
    this.currentWeather = weatherType.toLowerCase();
    
    switch(this.currentWeather) {
      case 'rain':
      case 'heavy rain':
        this.createHeavyRain();
        break;
      case 'light rain':
      case 'drizzle':
        this.createLightRain();
        break;
      case 'snow':
        this.createHeavySnow();
        break;
      case 'light snow':
        this.createLightSnow();
        break;
      case 'clear':
        this.createSunny();
        break;
      case 'few clouds':
        this.createFewClouds();
        break;
      case 'scattered clouds':
      case 'cloudy':
        this.createCloudy();
        break;
      case 'fog':
      case 'mist':
      case 'haze':
        this.createFog();
        break;
      case 'thunderstorm':
        this.createThunderstorm();
        break;
      default:
        this.createCloudy();
    }
  }

  // YOƒûUN YAƒûMUR
  createHeavyRain() {
    for (let i = 0; i < 150; i++) {
      const drop = document.createElement('div');
      drop.className = 'rain-drop';
      drop.style.left = `${Math.random() * 100}%`;
      drop.style.animationDuration = `${0.3 + Math.random() * 0.5}s`;
      drop.style.animationDelay = `${Math.random() * 1}s`;
      drop.style.width = '3px';
      drop.style.height = '25px';
      this.container.appendChild(drop);
    }
  }

  // HAFƒ∞F YAƒûMUR
  createLightRain() {
    for (let i = 0; i < 50; i++) {
      const drop = document.createElement('div');
      drop.className = 'rain-drop';
      drop.style.left = `${Math.random() * 100}%`;
      drop.style.animationDuration = `${1 + Math.random() * 2}s`;
      drop.style.animationDelay = `${Math.random() * 3}s`;
      drop.style.width = '2px';
      drop.style.height = '15px';
      drop.style.opacity = '0.6';
      this.container.appendChild(drop);
    }
  }

  // YOƒûUN KAR YAƒûI≈ûI
  createHeavySnow() {
    const heavySnowTypes = [
      { class: 'snow-heavy-small', count: 25 },
      { class: 'snow-heavy-medium', count: 20 },
      { class: 'snow-heavy-large', count: 15 }
    ];

    heavySnowTypes.forEach(type => {
      for (let i = 0; i < type.count; i++) {
        const snow = document.createElement('img');
        snow.className = `snow-flake ${type.class}`;
        snow.src = 'https://i.ibb.co/6JFtbkYM/animasyon-kar.png';
        snow.alt = 'Kar tanesi';
        
        snow.style.left = `${Math.random() * 100}%`;
        snow.style.animationDuration = `${4 + Math.random() * 4}s`;
        snow.style.animationDelay = `${Math.random() * 2}s`;
        
        this.container.appendChild(snow);
      }
    });
  }

  // HAFƒ∞F KAR YAƒûI≈ûI
  createLightSnow() {
    const lightSnowTypes = [
      { class: 'snow-light-small', count: 8 },
      { class: 'snow-light-medium', count: 6 },
      { class: 'snow-light-large', count: 4 }
    ];

    lightSnowTypes.forEach(type => {
      for (let i = 0; i < type.count; i++) {
        const snow = document.createElement('img');
        snow.className = `snow-flake ${type.class}`;
        snow.src = 'https://i.ibb.co/6JFtbkYM/animasyon-kar.png';
        snow.alt = 'Kar tanesi';
        
        snow.style.left = `${Math.random() * 100}%`;
        snow.style.animationDuration = `${12 + Math.random() * 10}s`;
        snow.style.animationDelay = `${Math.random() * 5}s`;
        
        this.container.appendChild(snow);
      }
    });
  }

  createSunny() {
    const sun = document.createElement('div');
    sun.className = 'sun-animation';
    this.container.appendChild(sun);
  }

  // AZ BULUTLU
  createFewClouds() {
    for (let i = 0; i < 2; i++) {
      const cloud = document.createElement('img');
      cloud.src = 'https://i.ibb.co/prfZ7krG/animasyon-bulut.png';
      cloud.className = 'cloud-img';
      cloud.style.top = `${30 + Math.random() * 30}%`;
      cloud.style.width = `${80 + Math.random() * 40}px`;
      cloud.style.animationDuration = `${60 + Math.random() * 40}s`;
      cloud.style.animationDelay = `${Math.random() * 10}s`;
      cloud.style.opacity = '0.4';
      this.container.appendChild(cloud);
    }
  }

  // √áOK BULUTLU
  createCloudy() {
    for (let i = 0; i < 5; i++) {
      const cloud = document.createElement('img');
      cloud.src = 'https://i.ibb.co/prfZ7krG/animasyon-bulut.png';
      cloud.className = 'cloud-img';
      cloud.style.top = `${20 + Math.random() * 50}%`;
      cloud.style.width = `${150 + Math.random() * 100}px`;
      cloud.style.animationDuration = `${40 + Math.random() * 30}s`;
      cloud.style.animationDelay = `${Math.random() * 10}s`;
      cloud.style.opacity = '0.8';
      this.container.appendChild(cloud);
    }
  }

  createFog() {
    const fog = document.createElement('div');
    fog.className = 'fog';
    this.container.appendChild(fog);
  }

  createThunderstorm() {
    this.createHeavyRain();
    this.thunderstormInterval = setInterval(() => {
      if (Math.random() > 0.7) {
        this.container.style.backgroundColor = 'rgba(255, 255, 255, 0.3)';
        setTimeout(() => {
          this.container.style.backgroundColor = 'transparent';
        }, 100);
      }
    }, 2000);
  }

  clearAnimation() {
    this.container.innerHTML = '';
    this.container.style.backgroundColor = 'transparent';
    if (this.thunderstormInterval) {
      clearInterval(this.thunderstormInterval);
      this.thunderstormInterval = null;
    }
  }
}

const weatherAnim = new WeatherAnimation();

// === DETAYLI HAVA DURUMU VERƒ∞Sƒ∞ ===
async function loadWeather() {
  const apiKey = "c5155ad22a417a8b1068985b43425bb3";
  const city = "Develi,TR";

  try {
    const currentRes = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=tr`);
    const currentData = await currentRes.json();
    
    const temp = Math.round(currentData.main.temp);
    const weatherMain = currentData.weather[0].main;
    const weatherDesc = currentData.weather[0].description.toLowerCase();
    const clouds = currentData.clouds.all;

    // Detaylƒ± hava durumu tespiti
    let displayDesc = "";
    let weatherType = "";

    // YAƒûMUR DURUMLARI
    if (weatherMain === "Rain") {
      if (weatherDesc.includes("hafif") || weatherDesc.includes("light") || weatherDesc.includes("√ßisenti")) {
        displayDesc = "HAFƒ∞F YAƒûMUR";
        weatherType = "light rain";
      } else if (weatherDesc.includes("≈üiddetli") || weatherDesc.includes("heavy")) {
        displayDesc = "YOƒûUN YAƒûMUR";
        weatherType = "heavy rain";
      } else {
        displayDesc = "YAƒûMURLU";
        weatherType = "rain";
      }
    }
    // KAR DURUMLARI
    else if (weatherMain === "Snow") {
      if (weatherDesc.includes("hafif") || weatherDesc.includes("light")) {
        displayDesc = "HAFƒ∞F KAR";
        weatherType = "light snow";
      } else {
        displayDesc = "YOƒûUN KAR";
        weatherType = "snow";
      }
    }
    // BULUT DURUMLARI
    else if (weatherMain === "Clouds") {
      if (clouds < 50) {
        displayDesc = "AZ BULUTLU";
        weatherType = "few clouds";
      } else if (clouds < 85) {
        displayDesc = "PAR√áALI BULUTLU";
        weatherType = "scattered clouds";
      } else {
        displayDesc = "√áOK BULUTLU";
        weatherType = "cloudy";
      }
    }
    // Dƒ∞ƒûER DURUMLAR
    else if (weatherMain === "Clear") {
      displayDesc = "A√áIK";
      weatherType = "clear";
    }
    else if (weatherMain === "Thunderstorm") {
      displayDesc = "G√ñKG√úR√úLT√úL√ú";
      weatherType = "thunderstorm";
    }
    else if (weatherMain === "Drizzle") {
      displayDesc = "√áƒ∞SENTƒ∞";
      weatherType = "drizzle";
    }
    else if (weatherMain === "Mist" || weatherMain === "Fog" || weatherMain === "Haze") {
      displayDesc = "Sƒ∞SLƒ∞";
      weatherType = "fog";
    }
    else {
      displayDesc = currentData.weather[0].description.toUpperCase();
      weatherType = weatherMain.toLowerCase();
    }

    // Bilgileri g√∂ster
    document.getElementById("temp").innerText = temp + "¬∞C";
    document.getElementById("desc").innerText = displayDesc;

    // ƒ∞konu ayarla
    const iconMap = {
      'clear': 'https://i.ibb.co/nMGFsvFZ/sunny.png',
      'few clouds': 'https://i.ibb.co/PsJcCksK/cloudy.png', 
      'scattered clouds': 'https://i.ibb.co/PsJcCksK/cloudy.png',
      'cloudy': 'https://i.ibb.co/PsJcCksK/cloudy.png',
      'rain': 'https://i.ibb.co/7JJ2bHmv/rainy.png',
      'light rain': 'https://i.ibb.co/Z6CPWfmb/light-rain.png',
      'heavy rain': 'https://i.ibb.co/XkG5bQLV/heavy-rain.png',
      'snow': 'https://i.ibb.co/KpYyTL3p/snowy.png',
      'light snow': 'https://i.ibb.co/B22f8nKS/snowy.png',
      'thunderstorm': 'https://i.ibb.co/VYMPDjnD/thunderstorm.png',
      'drizzle': 'https://i.ibb.co/0VdZDrbY/rainy.png',
      'fog': 'https://i.ibb.co/Z6LPQmfx/cloudy.png'
    };

    document.getElementById("weatherIcon").src = iconMap[weatherType] || 'https://i.ibb.co/Z6LPQmfx/cloudy.png';
    // Animasyonu ba≈ülat
    weatherAnim.setWeather(weatherType);

    // 3 G√úNL√úK TAHMƒ∞N
    const forecastRes = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric&lang=tr`);
    const forecastData = await forecastRes.json();
    
    const daysMap = ["Paz", "Pzt", "Sal", "√áar", "Per", "Cum", "Cts"];
    const dailyForecast = [];
    const addedDates = new Set();

    for (let item of forecastData.list) {
      const date = new Date(item.dt_txt);
      const dateKey = date.toDateString();
      
      if (!addedDates.has(dateKey) && dailyForecast.length < 3) {
        addedDates.add(dateKey);
        dailyForecast.push({
          dayName: daysMap[date.getDay()],
          temp: Math.round(item.main.temp)
        });
      }
    }

    const forecastContainer = document.querySelector("#weatherBox .forecast");
    forecastContainer.innerHTML = dailyForecast.map(d => `
      <div class="day">
        <div class="dayName">${d.dayName}</div>
        <div class="temp">${d.temp}¬∞C</div>
      </div>
    `).join("");

  } catch (error) {
    console.error("Hava durumu hatasƒ±:", error);
    document.getElementById("temp").innerText = "--";
    document.getElementById("desc").innerText = "‚ùå Veri alƒ±namadƒ±";
    weatherAnim.setWeather('cloudy');
  }
}

function updateWeatherHourly() {
  const now = new Date();
  const delay = (60 - now.getMinutes())*60*1000 - now.getSeconds()*1000;
  setTimeout(() => {
    loadWeather();
    setInterval(loadWeather, 3600000);
  }, delay);
}
loadWeather();
updateWeatherHourly();

// === EVENT LISTENERS ===
window.addEventListener("resize", fitTextToBox);
window.addEventListener("resize", fitMenuText);

// Sayfa y√ºklendiƒüinde kaydedilmi≈ü Excel verilerini i≈üle (G√úNCELLENDƒ∞)
window.addEventListener('load', function() {
  // localStorage'dan verileri √ßek
  const savedDutyData = localStorage.getItem('dutyData');
  const savedMenuData = localStorage.getItem('menuData');
  const savedQuoteData = localStorage.getItem('quoteData'); // YENƒ∞ EKLENDƒ∞
  
  // N√∂bet√ßi Listesi
  if (savedDutyData) {
    dutyData = JSON.parse(savedDutyData); // JSON'dan JavaScript nesnesine √ßevir
    processDutyData();
  }
  
  // Yemek Listesi
  if (savedMenuData) {
    menuData = JSON.parse(savedMenuData); // JSON'dan JavaScript nesnesine √ßevir
    processMenuData();
  }
  
  // G√ºn√ºn S√∂z√º
  if (savedQuoteData) { // YENƒ∞ KONTROL
    quoteData = JSON.parse(savedQuoteData); // JSON'dan JavaScript nesnesine √ßevir
    processQuoteData();
  }

  // ƒ∞lk y√ºklemede metin sƒ±ƒüdƒ±rmayƒ± √ßalƒ±≈ütƒ±r (Veri olsun veya olmasƒ±n)
  fitTextToBox();
  fitMenuText();
});
</script>
</body>
</html>
